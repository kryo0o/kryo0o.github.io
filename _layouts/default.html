<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}</title>
  <!-- 兼容GitHub Pages的图标CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@6.4.0/css/all.min.css">
  <style>
    /* ========== 全局基础样式 ========== */
    :root {
      /* 基础配色（豆包风格） */
      --text-main: #24292e;
      --text-light: #666;
      --text-gray: #999;
      --border: #e5e6eb;
      --bg-main: #fafafa;
      --code-block-bg: #f5f7fa; /* 代码块整体背景（无分割） */
      --inline-code-bg: #f1f1f1;
      --inline-code-text: #e63946;
      --copy-btn-bg: #f0f2f5;
      --copy-btn-hover: #e5e6eb;
      --copy-success: #52c41a;
      
      /* 响应式尺寸（桌面/移动端） */
      --desktop: {
        --code-font: 14px;
        --inline-code-font: 13px;
        --copy-btn-size: 24px;
        --body-font: 16px;
        --container-padding: 20px;
      }
      --mobile: {
        --code-font: 12px;
        --inline-code-font: 11px;
        --copy-btn-size: 20px;
        --body-font: 14px;
        --container-padding: 12px;
      }
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg-main);
      color: var(--text-main);
      line-height: 1.8;
      font-size: var(--body-font);
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 var(--container-padding);
    }

    /* ========== 头部样式（响应式） ========== */
    header {
      width: 100%;
      background: #fff;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      padding: 12px 0;
      position: sticky;
      top: 0;
      z-index: 999;
      margin-bottom: 20px;
    }
    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 var(--container-padding);
    }
    .site-title {
      font-size: clamp(18px, 2vw, 20px); /* 响应式标题 */
      font-weight: 600;
      color: #333;
      text-decoration: none;
    }

    /* ========== 1. 行内代码：仅高亮，无任何复制功能 ========== */
    p > code, li > code, h1 > code, h2 > code, h3 > code,
    div > code:not(.highlighter-rouge code) {
      background: var(--inline-code-bg);
      border: 1px solid var(--border);
      border-radius: 3px;
      padding: 2px 6px;
      font-size: var(--inline-code-font);
      font-family: Consolas, Monaco, 'Courier New', monospace;
      color: var(--inline-code-text);
      margin: 0 2px;
    }

    /* ========== 2. MD块级代码框：核心样式（无分割线+仅横向滚动） ========== */
    /* 仅针对MD ``` 渲染后的块级容器，排除行内 */
    .highlighter-rouge {
      position: relative;
      background: var(--code-block-bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      margin: 16px 0;
      overflow: hidden; /* 隐藏溢出，无分割线关键 */
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    /* 代码块头部（语言+复制按钮）：无分割线，背景和主体一致 */
    .code-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 16px;
      background: var(--code-block-bg); /* 和主体同背景，无分割 */
      font-size: 14px;
      border-bottom: 0 !important; /* 强制无分割线 */
    }
    .code-lang {
      color: var(--text-gray);
      font-family: Consolas, monospace;
    }

    /* 代码内容：仅横向滚动，禁止上下滚动，无分割 */
    .highlighter-rouge pre {
      padding: 16px !important;
      margin: 0 !important;
      overflow-x: auto !important;
      overflow-y: hidden !important; /* 仅横向滚动 */
      font-family: Consolas, Monaco, 'Courier New', monospace;
      font-size: var(--code-font);
      line-height: 1.6;
      white-space: pre !important; /* 保留格式，不换行 */
      background: transparent !important; /* 无背景分割 */
    }
    /* 覆盖Jekyll原生样式，彻底消除分割线 */
    .highlighter-rouge .highlight {
      background: transparent !important;
      border: 0 !important;
      margin: 0 !important;
      padding: 0 !important;
    }
    .highlighter-rouge code {
      background: transparent !important;
      padding: 0 !important;
      border: 0 !important;
      font-size: inherit !important;
      color: var(--text-main) !important;
    }

    /* ========== 3. 复制按钮：仅1个，仅图标，豆包浅灰 ========== */
    .copy-btn {
      position: absolute !important;
      top: 8px !important;
      right: 8px !important;
      width: var(--copy-btn-size) !important;
      height: var(--copy-btn-size) !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      background: var(--copy-btn-bg) !important;
      border: none !important;
      border-radius: 4px !important;
      color: var(--text-light) !important;
      cursor: pointer !important;
      font-size: calc(var(--copy-btn-size) * 0.5) !important;
      opacity: 0.8 !important;
      transition: all 0.2s !important;
      z-index: 10 !important;
      /* 强制避免重复按钮：只显示一个 */
      pointer-events: auto !important;
    }
    .copy-btn:hover {
      opacity: 1 !important;
      background: var(--copy-btn-hover) !important;
    }
    .copy-btn.copied {
      background: var(--copy-success) !important;
      color: #fff !important;
    }

    /* ========== 4. 复制提示框（响应式） ========== */
    .toast {
      position: fixed;
      top: clamp(12px, 2vw, 20px);
      right: clamp(12px, 2vw, 20px);
      padding: clamp(8px, 1vw, 12px) clamp(12px, 2vw, 20px);
      background: var(--copy-success);
      color: white;
      border-radius: 4px;
      font-size: var(--inline-code-font);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 9999;
      opacity: 0;
      transform: translateX(20px);
      transition: all 0.3s ease;
      max-width: 80%; /* 移动端不超宽 */
    }
    .toast.show {
      opacity: 1;
      transform: translateX(0);
    }

    /* ========== 响应式适配（768px以下移动端） ========== */
    @media (max-width: 768px) {
      :root {
        --code-font: 12px;
        --inline-code-font: 11px;
        --copy-btn-size: 20px;
        --body-font: 14px;
        --container-padding: 12px;
      }
      .code-header {
        padding: 6px 12px;
        font-size: 12px;
      }
      .highlighter-rouge pre {
        padding: 12px !important;
      }
      .toast {
        padding: 8px 12px;
        font-size: 11px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <a href="{{ '/' | relative_url }}" class="site-title">{{ site.title }}</a>
    </div>
  </header>

  <main>{{ content }}</main>

  <script>
    // ========== 核心逻辑：仅给块级代码框加1个复制按钮，杜绝重复 ==========
    // 标记是否已初始化，防止重复执行
    let isInitialized = false;

    // 复制提示函数
    function showToast(text) {
      const oldToast = document.querySelector('.toast');
      if (oldToast) oldToast.remove();
      
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = text;
      document.body.appendChild(toast);
      
      setTimeout(() => toast.classList.add('show'), 50);
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // 初始化代码块（仅执行一次）
    function initCodeBlocks() {
      // 防止重复初始化（核心：只执行一次）
      if (isInitialized) return;
      isInitialized = true;

      // 仅处理MD ``` 渲染后的块级代码框
      const codeBlocks = document.querySelectorAll('.highlighter-rouge');
      codeBlocks.forEach(block => {
        // 1. 先清除所有已存在的复制按钮（杜绝重复）
        const existingBtns = block.querySelectorAll('.copy-btn');
        existingBtns.forEach(btn => btn.remove());

        // 2. 提取代码语言（从```后的标识解析）
        let lang = '代码';
        const preText = block.querySelector('pre').textContent.trim();
        const langMatch = preText.match(/^```(\w+)/);
        if (langMatch) {
          lang = langMatch[1];
          // 移除MD代码块的```标记（不影响复制内容）
          block.querySelector('pre').textContent = preText.replace(/^```\w*\n/, '').replace(/\n```$/, '');
        }

        // 3. 创建仅1个头部（语言+复制按钮）
        let header = block.querySelector('.code-header');
        // 若已有头部则复用，避免重复创建
        if (!header) {
          header = document.createElement('div');
          header.className = 'code-header';
          
          const langEl = document.createElement('div');
          langEl.className = 'code-lang';
          langEl.textContent = lang;
          
          header.appendChild(langEl);
          block.prepend(header);
        }

        // 4. 创建仅1个复制按钮（仅图标，无文字）
        const copyBtn = document.createElement('button');
        copyBtn.className = 'copy-btn';
        copyBtn.innerHTML = '<i class="fas fa-copy"></i>'; // 仅复制图标
        copyBtn.setAttribute('aria-label', '复制代码');
        
        // 加入头部，确保仅1个
        header.appendChild(copyBtn);

        // 5. 绑定复制事件（兼容GitHub Pages）
        copyBtn.addEventListener('click', async () => {
          try {
            const codeContent = block.querySelector('pre').textContent.trim();
            // 现代API + 降级方案
            if (navigator.clipboard) {
              await navigator.clipboard.writeText(codeContent);
            } else {
              const textarea = document.createElement('textarea');
              textarea.value = codeContent;
              document.body.appendChild(textarea);
              textarea.select();
              document.execCommand('copy');
              document.body.removeChild(textarea);
            }
            // 按钮状态切换（仅图标）
            copyBtn.innerHTML = '<i class="fas fa-check"></i>';
            copyBtn.classList.add('copied');
            showToast('代码已复制');
            
            // 恢复初始状态
            setTimeout(() => {
              copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
              copyBtn.classList.remove('copied');
            }, 1500);
          } catch (err) {
            console.error('复制失败:', err);
            copyBtn.innerHTML = '<i class="fas fa-times"></i>';
            copyBtn.classList.add('error');
            showToast('复制失败，请手动复制');
            setTimeout(() => {
              copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
              copyBtn.classList.remove('error');
            }, 1500);
          }
        });
      });
    }

    // 页面完全加载后执行（确保MD代码块已渲染，仅执行一次）
    window.addEventListener('load', initCodeBlocks);

    // 防止意外重复调用的兜底
    window.initCodeBlocks = initCodeBlocks;
  </script>
</body>
</html>