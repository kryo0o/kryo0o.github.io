<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --color-text-main: #24292e;
      --color-text-light: #666;
      --color-text-gray: #999;
      --color-border: #e5e6eb;
      --color-bg-main: #fafafa;
      --color-bg-code-block: #f5f7fa;
      --color-bg-code-inline: #f1f1f1;
      --color-bg-copy-btn: #d9d9d9;
      --color-bg-copy-btn-hover: #bfbfbf;
      --color-bg-copy-success: #52c41a;
      --color-bg-copy-error: #ff4d4f;
      --border-radius-sm: 3px;
      --border-radius-md: 4px;
      --border-radius-lg: 6px;
      --font-code: "Consolas", "Monaco", "Courier New", monospace;
      --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-main);
      background-color: var(--color-bg-main);
      color: var(--color-text-main);
      line-height: 1.8;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    header.header-wrapper {
      width: 100%;
      background: #fff;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      padding: 12px 0;
      position: sticky;
      top: 0;
      z-index: 999;
    }

    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .site-title {
      font-size: 20px;
      font-weight: 600;
      color: #333;
    }

    main.container-main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* 行内代码样式 */
    .container-main p > code,
    .container-main li > code,
    .container-main span > code,
    .container-main div > code:not(.code-block code) {
      background-color: var(--color-bg-code-inline);
      border-radius: var(--border-radius-sm);
      padding: 2px 6px;
      font-size: 13px;
      font-family: var(--font-code);
      color: var(--color-text-main);
      border: 1px solid var(--color-border);
      margin: 0 2px;
    }

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- 头部内容不变 -->
  <style>
    /* 保持其他样式不变，仅调整代码块选择器逻辑 */
    /* 合并代码块样式，统一使用 .code-container 作为容器类 */
    .code-container {
      background: var(--color-bg-code-block);
      border: 1px solid var(--color-border);
      border-radius: var(--border-radius-lg);
      padding: 12px;
      margin: 16px 0;
      overflow-x: auto;
      position: relative;
      font-size: 14px;
      line-height: 1.6;
      max-width: 100%;
      scrollbar-width: thin;
      scrollbar-color: var(--color-border) var(--color-bg-code-block);
      padding-right: 40px; /* 预留按钮空间 */
    }
    /* 移除原 .code-block 和 .highlight 的独立样式，统一由 .code-container 接管 */
  </style>
</head>
<body>
  <!-- 页面结构不变 -->

  <script>
    // 创建通知提示函数（不变）
    function showNotification(message, type = 'success') {
      const existingNotifications = document.querySelectorAll('.notification');
      existingNotifications.forEach(notification => notification.remove());
      
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        if (notification.parentNode) {
          notification.style.opacity = '0';
          setTimeout(() => notification.remove(), 300);
        }
      }, 3000);
    }

    // 优化复制按钮初始化逻辑
    function initCodeCopyButtons() {
      // 1. 统一选择器：仅处理带 code 的容器（优先使用明确的 .code-container）
      // 兼容旧代码块，同时避免重复匹配
      const codeContainers = document.querySelectorAll(
        '.code-container, 
        .code-block:not(.code-container), 
        .highlight:not(.code-container)'
      );
      
      codeContainers.forEach(container => {
        // 2. 强制添加统一容器类，避免重复处理
        if (!container.classList.contains('code-container')) {
          container.classList.add('code-container');
        }
        
        // 3. 严格检查是否已有按钮（使用唯一类名）
        if (container.querySelector('.code-copy-btn')) {
          return; // 已存在则跳过
        }
        
        // 创建并添加按钮
        const copyBtn = document.createElement('button');
        copyBtn.className = 'code-copy-btn';
        copyBtn.innerHTML = '<i class="fa-solid fa-copy"></i>';
        copyBtn.setAttribute('aria-label', '复制代码');
        container.appendChild(copyBtn);

        // 复制逻辑（不变）
        const copySuccess = () => {
          copyBtn.innerHTML = '<i class="fa-solid fa-check"></i>';
          copyBtn.classList.add('copied');
          copyBtn.classList.remove('error');
          showNotification('代码已复制到剪贴板！', 'success');
          setTimeout(() => {
            copyBtn.innerHTML = '<i class="fa-solid fa-copy"></i>';
            copyBtn.classList.remove('copied');
          }, 1500);
        };

        const copyFail = (err) => {
          console.error('复制失败：', err);
          copyBtn.innerHTML = '<i class="fa-solid fa-times"></i>';
          copyBtn.classList.add('error');
          copyBtn.classList.remove('copied');
          let errorMessage = '复制失败，请手动复制代码';
          if (err.name === 'NotAllowedError') errorMessage = '需要用户手势才能访问剪贴板';
          else if (err.name === 'NotFoundError') errorMessage = '不支持剪贴板API';
          else if (err.message) errorMessage = `复制失败：${err.message}`;
          showNotification(errorMessage, 'error');
          setTimeout(() => {
            copyBtn.innerHTML = '<i class="fa-solid fa-copy"></i>';
            copyBtn.classList.remove('error');
          }, 1500);
        };

        copyBtn.addEventListener('click', async () => {
          const preEl = container.querySelector('pre');
          let codeContent = preEl ? preEl.textContent : 
                            container.querySelector('code')?.textContent || 
                            container.textContent.trim();

          if (!codeContent) return copyFail(new Error('未检测到可复制的代码'));

          try {
            if (!navigator.clipboard) throw new Error('浏览器不支持剪贴板API');
            await navigator.clipboard.writeText(codeContent);
            copySuccess();
          } catch (err) {
            try {
              const textArea = document.createElement('textarea');
              textArea.value = codeContent;
              textArea.style.position = 'fixed';
              textArea.style.left = '-999999px';
              document.body.appendChild(textArea);
              textArea.focus();
              textArea.select();
              const successful = document.execCommand('copy');
              document.body.removeChild(textArea);
              successful ? copySuccess() : copyFail(err);
            } catch (fallbackErr) {
              copyFail(err);
            }
          }
        });
      });
    }

    // 页面加载和动态更新时均执行
    document.addEventListener('DOMContentLoaded', initCodeCopyButtons);
    // 监听动态内容变化（如分页加载的代码块）
    const observer = new MutationObserver(initCodeCopyButtons);
    observer.observe(document.body, { childList: true, subtree: true });
  </script>
</body>
</html>